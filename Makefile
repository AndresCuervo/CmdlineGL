all: build clean

build: IntConstHash.o CmdHash.o Main.o

Main.o: Main.c Client.h Server.h Global.h
	gcc -c Main.c

Client.o: Client.c Client.h Global.h
	gcc -c Client.c
	
Server.o: Server.c Server.h Global.h
	gcc -c Server.c

IntConstHash.o: SymbolHash.h IntConstHash.c IntConstHash.autogen.c
	gcc -c IntConstHash.c

CmdHash.o: SymbolHash.h CmdHash.c CmdHash.autogen.c
	gcc -c CmdHash.c

IntConstHash.autogen.c: HashTableGen.class ConstList.txt
	echo "// This data automatically generated by makefile.  Do not modify." > IntConstHash.autogen.c;
	sed -r 's/(GL([^ 	]+))/DATA \2 (int)(\1)/' < ConstList.txt \
	 | java HashTableGen 1024 IntConstLookup Bucket 'struct IntConstHashEntry' >> IntConstHash.autogen.c

CmdHash.autogen.c: HashTableGen.class CmdHash.c
	java HashTableGen 256 CmdLookup Bucket 'struct CmdHashEntry' < FuncLib.h > CmdHash.autogen.c

HashTableGen.class: HashTableGen.java
	javac HashTableGen.java

GLConstList.txt: /usr/include/GL/gl.h /usr/include/GL/glu.h /usr/include/GL/glut.h
	grep "#define" /usr/include/GL/gl.h /usr/include/GL/glu.h /usr/include/GL/glut.h \
	 | sed -r -n 's/^.*#define[ 	]+(GL[^ 	]+).*/\1/p' \
	 > GLConstList.txt

clean:
	rm *.autogen.c
	rm *.class
	rm *.o
